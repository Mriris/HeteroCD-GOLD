超参数:
$e_{w}$ - 热身轮次
$w_{f}$ - 固定权重集合
$w_{CD}$, $w_{D}$, $w_{A}$, $w_{T}$, $w_{DW}$ - 各任务损失权重
$\eta$ - 学习率
$\theta_{1}$, $\theta_{2}$ - 自适应阈值系数(1.3和1.5)
$\lambda_{c}$, $\lambda_{nc}$ - 变化区域和非变化区域损失权重
$\alpha_{f}$, $\alpha_{a}$, $\alpha_{d}$ - 特征级、注意力和差异图损失权重
$\varepsilon$ - 小常数(用于数值稳定性)

输入:
当前轮次, 各任务当前损失值, 当前批次变化区域比例, 教师网络和学生网络特征

输出:
更新后的任务权重, 动态权重损失

过程:
// 1. 基于不确定性的任务权重学习
// 不确定性参数是可学习参数(log_vars)，通过反向传播更新
// 使用softplus函数确保数值稳定性
精度值 = softplus(-log_vars) + $\varepsilon$  // 不确定性越高，权重越低

// 增加变化检测损失的关注度
变化检测关注因子 = 1.2
精度值[0] = 精度值[0] * 变化检测关注因子  // CD损失下标为0

// 2. 热身阶段过渡（从固定权重到动态权重）
if 当前轮次 <= $e_{w}$:
    // 使用余弦退火计算热身系数，实现平滑过渡
    热身系数 = 0.5 * (1 - cos(当前轮次/$e_{w}$ * $\pi$))
    
    // 固定权重：[CD损失权重, 蒸馏损失权重, 差异图损失权重]
    固定权重 = [init_cd_weight, init_distill_weight, init_diff_att_weight]
    
    // 归一化固定权重
    固定权重 = 固定权重 / sum(固定权重)
    
    // 归一化动态权重
    动态权重 = 精度值 / sum(精度值)
    
    // 混合固定权重和动态权重
    权重 = (1 - 热身系数) * 固定权重 + 热身系数 * 动态权重
else:
    // 训练后期：添加自适应增强机制
    后期增强系数 = min(1.0 + (当前轮次 - $e_{w}$) / 100.0, 1.5)
    精度值[0] = 精度值[0] * 后期增强系数  // 逐渐增加CD损失权重
    
    // 计算并归一化权重
    权重 = 精度值 / sum(精度值)

// 3. 重新缩放权重到原始量级
缩放因子 = [init_cd_weight, init_distill_weight, init_diff_att_weight]
权重 = 权重 * sum(缩放因子)
缩放权重 = 权重 * 缩放因子

CD损失权重 = 缩放权重[0]
蒸馏损失权重 = 缩放权重[1]
差异图损失权重 = 缩放权重[2]

// 4. 类别不平衡自适应处理
if 变化区域比例 < 0.1:  // 变化区域较少时增加权重
    CD损失权重 = CD损失权重 * (1 + 5 * (0.1 - 变化区域比例))

// 5. 计算动态异源权重迁移损失
// 确保所有特征在相同尺寸
feat_size = (学生特征.size(2), 学生特征.size(3))
if 教师特征.shape[2:] != feat_size:
    教师特征 = 双线性插值(教师特征, size=feat_size)

if 光学时相1特征.shape[2:] != feat_size:
    光学时相1特征 = 双线性插值(光学时相1特征, size=feat_size)

if 光学时相2特征.shape[2:] != feat_size:
    光学时相2特征 = 双线性插值(光学时相2特征, size=feat_size)

if SAR时相特征.shape[2:] != feat_size:
    SAR时相特征 = 双线性插值(SAR时相特征, size=feat_size)

// 计算特征级损失、注意力级损失和差异图损失
特征级损失 = 均方误差(学生特征, 教师特征)
注意力损失 = 均方误差(学生注意力, 教师注意力)
差异图损失 = 均方误差(学生差异图, 教师差异图)

// 设置动态权重迁移损失的权重为差异图注意力损失权重的一半
动态权重损失权重 = 差异图损失权重 * 0.5

// 组合动态权重损失
动态权重损失 = $\alpha_{f}$ * 特征级损失 + $\alpha_{a}$ * 注意力损失 + $\alpha_{d}$ * 差异图损失
动态权重损失 = 动态权重损失 * 动态权重损失权重 